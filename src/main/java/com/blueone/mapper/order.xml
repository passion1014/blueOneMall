<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="order">

<!-- 	
	private int idx;
	
	private String orderStatCd;			// 주문상태 (01:주문중, 02:결제완료, 03:배송중, 04:배송완료, 05:고객확인)
	private BigDecimal totalOrderPrice;	// 총주문금액
	private BigDecimal deliveryPrice;	// 배송금액
	private String useWellfarePointYn;	// 복지카드포인트 사용여부
	
	private CustomerInfo customerInfo;	// 고객정보
	private CustomerContactInfo customerContactInfo;	// 고객배송지+연락처정보
	private List<OrderProductInfo> orderProductList;	// 주문상품정보
	private List<PaymentInfo> paymentLisit;				// 결제정보
	
	private String regDate;		// 등록일
	private String lastDate;	// 최종수정일
	private String modifyUserId;// 최종수정자
	
 -->
	<resultMap id="OrderInfoMap" type="orderInfo">
		<id property="ordIdx" column="IDX" javaType="int"/>
		<id property="orderNo" column="ORDER_NO" javaType="java.lang.String"/>
		<id property="orderStatCd" column="ORDER_STAT_CD" javaType="java.lang.String"/>
		<id property="orderDate" column="ORDER_DATE" javaType="java.lang.String"/>
		<id property="regDate" column="REG_DATE" javaType="java.lang.String"/>
		<id property="lastDate" column="LAST_DATE" javaType="java.lang.String"/>
		<id property="modifyUserId" column="MODIFY_USER_ID" javaType="java.lang.String"/>
		
		<!-- 고객정보 셋팅 -->
		<association property="customerInfo" column="custId" javaType="customerInfo" resultMap="CustomerInfoMap"/>
		

		<!-- 주문상품정보 셋팅 -->
		<collection property="orderProductList" ofType="orderProductInfo" resultMap="OrdProductInfo"/>
		
	</resultMap>

	<resultMap id="CustomerInfoMap" type="customerInfo">
		<id property="custId" column="ordCustId" javaType="java.lang.String"/>
	</resultMap>

	<resultMap id="OrdProductInfo" type="orderProductInfo">
		<id property="orderNo" column="ORDER_NO" javaType="java.lang.String"/>
		<id property="prdCd" column="PRD_CD" javaType="java.lang.String"/>
		<id property="regDate" column="REG_DATE" javaType="java.lang.String"/>
		<id property="lastDate" column="LAST_DATE" javaType="java.lang.String"/>
		<id property="modiUser" column="MODIFY_USER_ID" javaType="java.lang.String"/>
		<id property="prdOption" column="PRD_OPTION" javaType="java.lang.String"/>
		<id property="buyCnt" column="BUY_COUNT" javaType="int"/>
	</resultMap>


	<select id="selectListBomOrderTb0001" resultType="orderInfo" resultMap="OrderInfoMap" parameterType="orderSrchInfo">
		SELECT
			T1.IDX ,
			T1.ORDER_NO ,
			T1.CUST_ID AS custId ,
			T1.ORDER_STAT_CD,
			T1.ORDER_DATE ,
			T1.REG_DATE ,
			T1.LAST_DATE ,
			T1.MODIFY_USER_ID 
			<!-- T2.IDX AS payIdx,
			T2.ORDER_NO AS payOrdNo,
			T2.ORDER_NO_SEQ AS payOrdNoSeq,
			T2.PYMT_PAY_CD AS payCd,
			T2.PYMT_AMOUNT AS payAmount,
			T2.PYMT_DATE AS payDate,
			T2.REG_DATE AS payRegDate,
			T2.LAST_DATE AS payLastDate,
			T2.MODIFY_USER_ID AS payModifyUserId,
			T3.IDX AS pordIdx,
			T3.ORDER_NO AS pordOrdNo,
			T3.PRD_CD AS pordPrdCd, 
			T4.PRD_CD AS prdCd,
			T4.PRD_NM AS prdNm,
			T4.PRD_CTG_L AS prdCtgL,
			T4.PRD_CTG_M AS prdCtgM,
			T4.PRD_CTG_S AS prdCtgS,
			T4.FROM_DATE AS prdFromDate,
			T4.TO_DATE AS prdToDate -->
		FROM 
				BOM_ORDER_TB T1
			<!-- LEFT OUTER JOIN 
				BOM_PAYMENT_TB T2 ON T1.ORDER_NO = T2.ORDER_NO
			JOIN 
				BOM_ORD_PRD_TB T3 ON T1.ORDER_NO = T3.ORDER_NO
			JOIN 
				BOM_PRODUCT_TB T4 ON T3.PRD_CD = T4.PRD_CD -->
	<!-- 	WHERE
			T1.ORDER_DATE BETWEEN #{srchStdDt} AND #{srchEdDt} -->
	</select >

	
	
	<select id="selectListBomOrderPrdTb0001" resultType="orderProductInfo" resultMap="OrdProductInfo" parameterType="orderProductInfo">
		SELECT
			T1.ORDER_NO,
			T1.PRD_CD,
			T1.PRD_OPTION,
			T1.BUY_COUNT
			
		FROM 
				BOM_ORD_PRD_TB T1
		WHERE
			T1.ORDER_NO = #{orderNo}
	</select >
	
	<select id="selectListBomOrderTb0002" resultType="orderInfo" resultMap="OrderInfoMap" parameterType="orderInfo">
		SELECT
			T1.ORDER_NO,
			T1.CUST_ID,
			T1.ORDER_STAT_CD,
			T1.ORDER_DATE,
			T1.REG_DATE
		FROM 
				BOM_ORDER_TB T1
		WHERE
			T1.CUST_ID = #{customerInfo.custId}
	</select >

	<insert id="insertBomOrderPrdTb0001" parameterType="orderProductInfo" >
		INSERT BOM_ORD_PRD_TB
			(`ORDER_NO`,`PRD_CD`,`REG_DATE`,`LAST_DATE`,`MODIFY_USER_ID`,`PRD_OPTION`,`BUY_COUNT`)
			VALUES
			(#{orderNo}, #{prdCd}, sysdate(), sysdate(), #{modiUser}, #{prdOption},#{buyCnt})
	</insert>
	

	<insert id="insertBomOrderTb0001" parameterType="orderInfo" >
		INSERT BOM_ORDER_TB
			(`ORDER_NO`,`CUST_ID`,`ORDER_STAT_CD`,`ORDER_DATE`,`REG_DATE`,`LAST_DATE`,`MODIFY_USER_ID`)
			VALUES
			(#{orderNo}, #{customerInfo.custId},#{orderStatCd},sysdate(), sysdate(), sysdate(),#{modifyUserId})
	</insert>
	


</mapper>